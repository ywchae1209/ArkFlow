### 현장에서 살펴본 안타까움.

스스로 생각하는 만큼 우리가 능숙한 게 아닐지도.

------------------------
```java

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import java.util.Map;

String json = "";
ObjectMapper objectMapper = new ObjectMapper();
TypeReference<Map<String, Object>> typeReference = new TypeReference<Map<String,Object>>() {};

Map<String, Object> jsonMap = objectMapper.readValue(json, typeReference);
```
잠깐만 검색해보면, json을 다루는 위와 같은 샘플 코드들이 넘쳐나는 것을 찾을 수 있다.  

거의 대부분의 샘플들은 
1. 위와 같이 `Map<String, Object>` 형으로 읽어들 이거나,
2. 미리 읽어들일 데이터 구조에 짜맞춘 `class`를 정의하고 위의 코드의 `typeReference` 자리에 넣는 경우들이다.
   ( 예를 들면, Employee 클래스로 읽어들이는 식인데, 검색하면 쉽게 찾을 테니 생략)

`1.` 의 경우에는 원래의 데이터 였던 Json에는 있었던 구조정보가 사라진 `Object`가 되므로 
무엇을 읽어들인 것이고 어떻게 처리해야 할 것인지에 대한 실마리를 완전히 사라진다. 
( 이 이후의 코드들을 지루하게 쫓아가면서 살펴보는 방법 뿐; 험한 말이 입에서 나오기도 한다.)

`2.` 의 경우는 `1.`보다는 나으나, 원 Json이 살짝 바뀌 경우, `type class`를 일일이 바꿔 주어야 한다. 
(다루어야 할 json의 형식이 많아지면 그만큼 만들어야 한다.)

------------------------------------
[ 관찰 사례 ]

다루어야할 데이터의 구조를 알고 있다면, 아마도 위의 `2.`를 사용하면 될 텐데,  
( 대부분 이렇게 시작하기는 하는 것 같다. )  

초기에 잘 정의하지 못한 데이터 구조 ( 처음부터 잘한다는 게 말처럼 쉽지는 않다.)

기능의 추가,변경 또는 Bug수정 등 여하간의 이유로  
데이터 구조를 바꿀 때마다, 
이전 버전호환성을 유지하면서 해야되는 작업들...  
(호환성 유지를 생각하지 못하는 경우도 흔하다.)  
거기에 맞춰서 해야하는 일들.... 

결국 관리의 문제로... 

그래서, 어떻게든 돌아는 가면 좋겠다는 코드 ..   
( type 정보를 잃어버린 Map<String, `Object`>가 보이기 시작한다.)   

어떻게든 기능추가되고 Bugfix되고....
( 어느새 유형1과 유형2가 역전된다.)  ... 

그러다 발생하는 더이상 감당하기 어려운 run-time exception들...

결국 대환장의 혼란파티....   

* 조금 어처구니 없지만.. 이것이 생각보다 흔한 현상인 것 같다.
* 솔직히 말해보자. 처음부터 다시하면 이런 일 없을까?
* 아마도, 결국엔 비슷한 스토리가 되었을 게다.
* 대체, 무엇이 문제였을까?


-------------------
##### 다음과 같은 프로그램을 짠다고 생각해보자...

1. json형식으로 된 어떤 입력을 받을 것이다.
2. 그런데, 그 json 구조(어떤 field, array, sub-object들로 구성되어 있는지는) `구현하는 시점`에는 미리 알 수 없다.
3. `2.`의 구조는 `실행시점`에 주어진다.
4. `1.`의 데이터가 `3.`의 구조정보 부합하는 지 실행시점에 점검해야 한다.
5. 하나 더, `4.`의 점검을 통과한 데이터에서 원하는 정보 1개를 추출해야 한다.( 무엇을 뽑을 지는 `실행시점`에 주어진다)


**이런 프로그램을 어떻게 개발할 것인가?**

-------------------
사실, 꼭 json이 아니더라도 비슷한 경우는 얼마든지 생각해 볼 수 있다.

예를 들면, 구조를 가진 문자열 입력에 대해서 비슷하게 요건을 쓴다면, 다음과 같고   
( 마찬가지로 bit-stream에 대해서도 비슷한 요건을 정의할 수 있을 게다.)

1. String형식 된 어떤 입력을 받을 것이다.
2. 그런데, 그 Tree 구조( 필드명-값의 조합, 반복타입, 재귀적 필드-값 조합 등) `구현하는 시점`에는 미리 알 수 없다.
3. `2.`의 구조는 `실행시점`에 주어진다.
4. `1.`의 데이터가 `3.`의 구조정보 부합하는 지 실행시점에 점검해야 한다.
5. 하나 더, `4.`의 점검을 통과한 데이터에서 원하는 정보 1개를 추출해야 한다.( 무엇을 뽑을 지는 `실행시점`에 주어진다)

즉, 단순히 Json데이터를 어떻게 다루는 지 **API가 익숙하다/낯설다의 문제는 아니라는 게다.**

**다시한번, 생각해보자. 이런 프로그램을 어떻게 개발할 것인가?**
